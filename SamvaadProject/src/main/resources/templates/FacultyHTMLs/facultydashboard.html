<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Faculty || Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            font-size: 0.9rem;
        }

        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 70px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.1);
            min-height: 100vh;
        }

        .sidebar .nav-link {
            font-weight: 500;
            color: #333;
            padding: 0.75rem 1rem;
            margin: 0.125rem 0;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(13, 110, 253, 0.1);
        }

        .sidebar .nav-link i {
            margin-right: 0.5rem;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        .nav-tabs .nav-link {
            color: #000;
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            color: #f39c12 !important;
            /* Highlighted color like your screenshot */
        }

        .card {
            border-radius: 12px;
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
        }

        .card.shadow-sm {
            border-radius: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card.shadow-sm:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .dashboard-shortcut a {
            display: inline-block;
            text-align: center;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            /* smooth transition */
            border-radius: 8px;
            padding: 10px;
        }

        .dashboard-shortcut a:hover i {
            background-color: #FFBB33;
            color: white;
            transform: translateY(-4px);
            /* slight lift effect */
        }

        .dashboard-shortcut a:hover {
            background-color: #FFBB33;
            color: white;
            transform: translateY(-4px);
            /* slight lift effect */
        }

        /* Button Code  */

        .button {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
        }

        .button input[type="submit"],
        .button input[type="reset"] {
            background-color: rgb(40, 40, 64);
            color: white;
            padding: 10px;
            width: 49%;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: background 0.3s ease-in-out;
        }


        .button input[type="submit"]:hover,
        .button input[type="reset"]:hover {
            background: #FFBB33;
            /* background: var(--nav-dropdown-hover-color); */
        }



        /* Popup Css */

        .popup {
            visibility: hidden;
            min-width: 250px;
            background-color: #28a745;
            /* green success */
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 15px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 19px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.5s ease, bottom 0.5s ease;
        }

        /* Show the popup */
        .popup.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

         .loader {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #3498db;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 1s linear infinite;
  margin: auto;

}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
    </style>
</head>

<body>

<div id="popupMessage1" class="popup">
    ‚úÖ Assignment has been added successful!
</div>
<script th:if="${newAssignmentAdded}">
    popup = document.getElementById("popupMessage1");
    popup.classList.add("show");
    //Time
    setTimeout(() => {
        popup.classList.remove("show");
    }, 5000);
</script>

<div id="popupMessage2" class="popup">
    ‚úÖ Assignment has been deleted successful!
</div>
<script th:if="${assignmentDeleted}">
    popup = document.getElementById("popupMessage2");
    popup.classList.add("show");
    //Time
    setTimeout(() => {
        popup.classList.remove("show");
    }, 5000);
</script>

<div id="popupMessage3" class="popup">
    ‚úÖ Assignment has been updated successful!
</div>
<script th:if="${assignmentUpdated}">
    popup = document.getElementById("popupMessage3");
    popup.classList.add("show");
    //Time
    setTimeout(() => {
        popup.classList.remove("show");
    }, 5000);
</script>


<!-- Navbar -->
<nav class="navbar navbar-dark sticky-top bg-light flex-md-nowrap p-2 shadow">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center " href="#">
            <!--            <img src="https://cdn-icons-png.flaticon.com/512/1995/1995574.png" width="45" height="45" class="me-2">-->
            <img src="../Images/xansaitsulutionsLogo.png" width="150" height="60" alt="Logo">
            <span style="color:black;"><i class="bi bi-person-badge me-1"></i><span
                    th:text="${user_master.fullName}"></span></span>
        </a>

        <div class="d-flex align-items-center">
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="dropdownUser"
                   data-bs-toggle="dropdown">
                    <img th:if="${user_master.photoPath != null}" th:src="@{/userphoto/{id}(id=${user_master.userId})}" class="rounded-circle me-2"
                         width="40" height="40">
                    <div th:unless="${user_master.photoPath != null}">
                        <i class="fas fa-user-circle rounded-circle me-2 fs-1"></i>
                    </div>
                    <span class="d-none d-sm-inline text-dark" th:text="${user_master.fullName}"></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#"><i class="bi bi-person-circle me-2"></i>Profile</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" th:href="@{/logout}"><i
                            class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                </ul>
            </div>
        </div>
        <button class="btn btn-outline-light d-md-none me-2" type="button" data-bs-toggle="collapse"
                data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
                aria-label="Toggle navigation">
            <span style="color:black"><i class="bi bi-list"></i></span>
        </button>

    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse bg-white">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="#home"><i
                            class="bi bi-house me-2"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#profile"><i class="bi bi-person me-2"></i>My
                        Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="#students"><i
                            class="bi bi-people me-2"></i>Students</a></li>
                    <li class="nav-item"><a class="nav-link" href="#courses"><i
                            class="bi bi-mortarboard me-2"></i>Courses</a></li>
                    <li class="nav-item"><a class="nav-link" href="#assignments"><i
                            class="bi bi-journal-text me-2"></i>Assignments</a></li>
                    <li class="nav-item"><a class="nav-link" href="#attendance"><i
                            class="bi bi-calendar-check me-2"></i>Attendance</a></li>
                    <li class="nav-item"><a class="nav-link" href="#messages"><i
                            class="bi bi-chat-dots me-2"></i>Messages</a></li>
                    <li class="nav-item"><a class="nav-link text-danger" href="/logout"><i
                            class="bi bi-box-arrow-left me-2"></i>Logout</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <!-- Home -->
            <div id="home" class="dashboard-section active">
                <h2>Welcome Faculty üë®‚Äçüè´</h2>
                <p class="text-muted">This is your dashboard overview.</p>
            </div>

            <!-- Profile -->
            <div id="profile" class="dashboard-section">
                <h3>My Profile</h3>
                <p>üìå Faculty details will appear here.</p>
            </div>

            <!-- Students -->
            <div id="students" class="dashboard-section">
                <h3>Students</h3>
                <p>üë• Manage student details and performance.</p>
            </div>

            <!-- Courses -->
            <div id="courses" class="dashboard-section">
                <h3>Courses</h3>
                <p>üìö Courses assigned to you.</p>
            </div>

            <!-- Assignments -->
            <div id="assignments" class="dashboard-section">
                <h3 class="text-center mt-3">--Assignment Management--</h3>
                <div class="row mt-4">
                    <div class="col-lg-8 col-md-8 mb-3">
                        <div class="card p-3">

                            <!-- Tabs -->
                            <ul class="nav nav-tabs" id="myTab2" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="newassignment-tab" data-bs-toggle="tab"
                                            data-bs-target="#addnewassignment" type="button">New Assignment</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="updateassignment-tab" data-bs-toggle="tab"
                                            data-bs-target="#updateassignment" type="button">Update</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="usernotifications-tab" data-bs-toggle="tab"
                                            data-bs-target="#deleteassignment" type="button">Delete</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="all-assignments-tab" data-bs-toggle="tab"
                                            data-bs-target="#allassignments" type="button">All Assignments</button>
                                </li>
                            </ul>

                            <!-- Tab Content -->
                            <div class="tab-content p-3">
                                <div class="tab-pane fade show active" id="addnewassignment" role="tabpanel">
                                    <h5>Add New Assignment </h5>
                                    <form th:action="@{/done}" method="post" enctype="multipart/form-data"
                                          class="mb-4">
                                        <div class="mb-3">
                                            <label for="batchId" class="form-label">Select Batch:</label>
                                            <select id="batchId" name="batchId" class="form-select" required>
                                                <option value="" selected disabled>-- Select Batch --</option>
                                                <option th:each="batch : ${batches}" th:value="${batch.batchId}"
                                                        th:text="${batch.name}+' (BID -'+${batch.batchId}+')'"></option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="title">Title</label>
                                            <input type="text" class="form-control" id="title" name="title"
                                                   required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="file" class="form-label">Upload Assignment PDF:</label>
                                            <input type="file" id="file" name="file" accept="application/pdf"
                                                   class="form-control" required />
                                        </div>
                                        <div class="button">
                                            <input type="reset" value="Reset">
                                            <input type="submit" id="uploadButton" value="Upload">
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane fade " id="updateassignment" role="tabpanel">
                                    <h4>Update Assignment</h4>
                                    <form>
                                    <div class="mb-3">
                                        <label for="updateAssignmentBatchId" class="form-label">Select Batch:</label>
                                        <select id="updateAssignmentBatchId" name="assignmentBatchId" class="form-select" required>
                                            <option value="" selected disabled>-- Select Batch --</option>
                                            <option th:each="batch : ${batches}" th:value="${batch.batchId}"
                                                    th:text="${batch.name}+' (BID -'+${batch.batchId}+')'"></option>
                                        </select>
                                    </div>
                                </form>
                                    <div id="updatepdf" style="display:none;">
                                        <h3>Existing Assignments</h3>
                                        <table class="table table-bordered" id="updatetable">
                                            <thead class="table-light">
                                            <tr>
                                                <th>Title</th>
                                                <th>Assignments</th>
                                                <th>Update</th>
                                            </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="deleteassignment" role="tabpanel">
                                    <form>
                                        <div class="mb-3">
                                            <label for="assignmentBatchId" class="form-label">Select Batch:</label>
                                            <select id="assignmentBatchId" name="assignmentBatchId" class="form-select" required>
                                                <option value="" selected disabled>-- Select Batch --</option>
                                                <option th:each="batch : ${batches}" th:value="${batch.batchId}"
                                                        th:text="${batch.name}+' (BID -'+${batch.batchId}+')'"></option>
                                            </select>
                                        </div>
                                    </form>
                                    <div id="showdeletepdf" style="display:none;">
                                    <h3>Existing Assignments</h3>
                                    <table class="table table-bordered" id="assignmenttable">
                                        <thead class="table-light">
                                        <tr>
                                            <th>Title</th>
                                            <th>Assignments</th>
                                            <th>Delete</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        </tbody>
                                    </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="allassignments" role="tabpanel">
                                    <h5>All Assignments </h5>
                                    <p>User Notifications list goes here.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Right Section (Shortcuts) -->
                    <div class="col-lg-4 col-md-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- Thymeleaf fragment for shortcuts -->
                                <div th:insert="~{fragments :: shortcut}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:insert="~{fragments :: footer}"></div>
            </div>

            <!-- Attendance -->
            <div id="attendance" class="dashboard-section">
                <h3>Attendance</h3>
                <p>‚úÖ Record and view student attendance.</p>
            </div>

            <!-- Messages -->
            <div id="messages" class="dashboard-section">
                <h3>Messages</h3>
                <p>üí¨ Communicate with students and admin.</p>
            </div>
        </main>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS for section navigation -->
<script>
  /*  document.addEventListener('DOMContentLoaded', function () {
        const navLinks = document.querySelectorAll('.sidebar .nav-link');
        const sections = document.querySelectorAll('.dashboard-section');

        navLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                sections.forEach(section => section.classList.remove('active'));
                const targetId = this.getAttribute('href').substring(1);
                document.getElementById(targetId).classList.add('active');
            });
        });
    }); */

     document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('#sidebarMenu .nav-link');
            const sections = document.querySelectorAll('.dashboard-section');
            const sidebar = document.getElementById('sidebarMenu');

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault(); // Prevent page jump

                    // Remove active from all links and sections
                    navLinks.forEach(l => l.classList.remove('active'));
                    sections.forEach(section => section.classList.remove('active'));

                    // Add active to clicked link
                    this.classList.add('active');

                    // Show the corresponding section
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }

                    // Collapse sidebar if on small screens
                    if (window.innerWidth < 992 && sidebar) {
                        const collapseInstance = bootstrap.Collapse.getOrCreateInstance(sidebar);
                        collapseInstance.hide();
                    }
                });
            });
        });

</script>

<!--Delete Assignments-->
<script>
    document.getElementById("assignmentBatchId").addEventListener("change", function() {
       var assignmentBatchId = this.value;
        console.log("Course id "+assignmentBatchId);
        document.getElementById("showdeletepdf").style.display="block";
       if(assignmentBatchId) {
         fetch('/allassignmetbybatchid/' + assignmentBatchId)   // Call Spring Boot GET endpoint
           .then(response => response.json()) // Either JSON OR TEXT.
           .then(data => {
             let tbody = document.querySelector("#assignmenttable tbody");
                tbody.innerHTML = "";

             if(data.length === 0) {
               tbody.innerHTML = "<tr><td colspan='4' class='text-center text-muted'>No Assignment found</td></tr>";
               return;
             }

         data.forEach(assignment => {
           let row = `
             <tr>
               <td>${assignment.title}</td>
                         <td>
                ${assignment.pdfName} ${assignment.pdfDate}
                <a href="/studentAssignments/pdfs/${assignment.assignmentId}" target="_blank">View</a>
            </td>

               <td>
                   <form action="/delete_assignment/${assignment.assignmentId}" method="post"
                          onsubmit="return confirm('Delete this assignment?');">
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>


               </td>
             </tr>
           `;
           tbody.innerHTML += row;
         });
           })
           .catch(error => console.error('Error:', error));
       } else {
         //document.getElementById("fees").value = '0.0';
       }
     });
</script>

<!--Update Assignments-->
<script>
    document.getElementById("updateAssignmentBatchId").addEventListener("change", function() {
      var assignmentBatchId = this.value;
       console.log("Course id "+assignmentBatchId);
       document.getElementById("updatepdf").style.display="block";
      if(assignmentBatchId) {
        fetch('/allassignmetbybatchid/' + assignmentBatchId)   // Call Spring Boot GET endpoint
          .then(response => response.json()) // Either JSON OR TEXT.
          .then(data => {
            let tbody = document.querySelector("#updatetable tbody");
               tbody.innerHTML = "";

            if(data.length === 0) {
              tbody.innerHTML = "<tr><td colspan='4' class='text-center text-muted'>No Assignment found</td></tr>";
              return;
            }

        data.forEach(assignment => {
          let row = `
            <tr>
              <td>${assignment.title}</td>
              <td>${assignment.pdfName} ${assignment.pdfDate}
               <a href="/studentAssignments/pdfs/${assignment.assignmentId}" target="_blank">View</a>
                </td>
           <td>
            <form id="updateAssignmentForm" action="/update_assignment/${assignment.assignmentId}" onsubmit="return checkUpdateForm(event)" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="_method" value="put"/>
                        <input type="file" name="file" class="mb-3" accept="application/pdf" required>
                       <button type="submit" class="btn btn-sm btn-warning" id="assignmentUpdateButton">Update</button>
                   </form>
               </td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
          })
          .catch(error => console.error('Error:', error));
      } else {
        //document.getElementById("fees").value = '0.0';
      }
    });
</script>

<!--Update Popup-->
<div id="updatePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:white; padding:20px; border-radius:10px; text-align:center;">
        <div class="loader"></div>
        <h3>‚è≥ Please wait...</h3>
        <p>Your assignment is being updated.</p>
    </div>
</div>

    <script>
 function checkUpdateForm(event) {
    event.preventDefault(); // Prevent default form submission
        console.log("Inside On Submit Method");

      let userAns = confirm("Do you want to update?");
      if(!userAns)
            return false;
    // Disable the button to prevent multiple clicks
    let btn = document.getElementById("assignmentUpdateButton");
    btn.disabled = true;
    btn.innerText = "‚è≥ Updating...";

    // Show the popup
    document.getElementById("updatePopup").style.display = "flex";

    // Submit the form after a short delay to allow popup to render
    setTimeout(() => {
        event.target.submit();
    }, 4000); // 1s delay
}
</script>

</body>

</html>
